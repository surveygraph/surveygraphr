<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to the R version of surveygraph • surveygraph</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to the R version of surveygraph"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">surveygraph</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/surveygraph/surveygraphr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Contributing to the R version of surveygraph</h1>
      <small class="dont-index">Source: <a href="https://github.com/surveygraph/surveygraphr/blob/main/.github/CONTRIBUTING.md" class="external-link"><code>.github/CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-the-r-version-of-surveygraph" class="section level1">

<div class="section level2">
<h2 id="development-workflow">Development workflow<a class="anchor" aria-label="anchor" href="#development-workflow"></a></h2>
<p>These notes describe my personal workflow when working on this package, and is subject to change.</p>
<div class="section level3">
<h3 id="download">Download<a class="anchor" aria-label="anchor" href="#download"></a></h3>
<p>A local version of the package can be obtained by downloading the zipped repository from our <a href="https://github.com/surveygraph/surveygraphr" class="external-link">GitHub</a> organisation page, by selecting Code &gt; Download ZIP. This downloads the entire repository, including files related to development that won’t be included in the package available to end users. Or, if you use <code>git</code>, clone the repository in the usual way,</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">git</span> clone git@github.com:surveygraph/surveygraphr.git</span></code></pre></div>
<p>When it is made available on <a href="https://cran.r-project.org/" class="external-link">CRAN</a>, we’ll be able to download and install in a single step by running</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"surveygraph"</span><span class="op">)</span></span></code></pre></div>
<p>This is important for discoverability, as we want to assume that users won’t be comfortable building from source, or even installing from GitHub, as can be done using the <code>devtools</code> package. We elaborate on this below.</p>
</div>
<div class="section level3">
<h3 id="build-and-install-from-source">Build and install from source<a class="anchor" aria-label="anchor" href="#build-and-install-from-source"></a></h3>
<p>Note that neither of the download options (downloading a zip and git cloning) in the previous section actually installs the package. To build using the downloaded source (after unzipping if necessary), open a terminal and run</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">R</span> CMD BUILD .</span></code></pre></div>
<p>This compiles the <code>*.cc</code> source files to produce <code>*.o</code> object files, then bundles them to create a <code>*.so</code> shared object file. (The <code>build</code> command does a few other things too…). <em>[Say something here about ddl files, the NAMESPACE doc, R files etc etc.]</em> To install the [?] files, we run</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">R</span> CMD INSTALL .</span></code></pre></div>
<p>and the package is ready to use in an interpreter. Alternatively, the package can be installed from GitHub by running the following commands in an R interpreter.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"surveygraph/surveygraphr"</span><span class="op">)</span></span></code></pre></div>
<p>Note that it remains to solve the awkward problem of overloading the term “surveygraph”, which is the ideal final name of both the R and Python packages, but which necessitate different repository names in our organisation.</p>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<p>The standard check for R projects is <code>R CMD check</code> which i</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">R</span> CMD check .           <span class="co"># run especially before CRAN submissions</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="ex">R</span> CMD SHLIB src/<span class="pp">*</span>.cc    <span class="co"># for building shared object files</span></span></code></pre></div>
<p>Following the convention of the tidyverse, we carry out unit tests using the <code>testthat</code> package.</p>
</div>
<div class="section level3">
<h3 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a></h3>
<p>One can debug on the level of shared objects directly using <code>dyn.load</code>, as well as running <code>.Call</code> directly</p>
</div>
<div class="section level3">
<h3 id="documentation-workflow">Documentation workflow<a class="anchor" aria-label="anchor" href="#documentation-workflow"></a></h3>
<div class="section level4">
<h4 id="object-documentation">Object documentation<a class="anchor" aria-label="anchor" href="#object-documentation"></a></h4>
<p>To build object documentation, we run <code>devtools::document()</code>, which in turn calls <code>roxygenise()</code> from the <code>roxygen2</code> package. This function looks for <code>roxygen2</code> comments in markdown above R functions in the <code>R/</code> directory. We comment in markdown all exported functions in the <code>R/</code> directory. These comments are then translated to produce <code>.Rd</code> files in the <code>man/</code> directory. Further, roxygen2 will also build the <code>NAMESPACE</code> file based on the <code>@export</code> function tags.</p>
<p>The script <code>buildman.R</code> contains the commands</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">document</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build_vignettes</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>which populates <code>man/</code> when executed. Static site builders like <code>pkgdown</code> look in <code>man/</code> to produce site files, however commands like the following allow for a quick check of how <code>.Rd</code> files actually render.</p>
<pre><code>R CMD Rdconv -t html man/make_projection.Rd &gt; make_projections.html</code></pre>
<p>For more information see the CRAN page on <a href="https://cran.r-project.org/" class="external-link">writing R extensions</a>.</p>
</div>
<div class="section level4">
<h4 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a></h4>
<p>To build vignettes, we follow Wickham and use <code>knitr</code>, a markdown vignette engine. <code>knitr</code> is piloted by <code>rmarkdown</code>, which uses <code>pandoc</code> to convert between markdown and HTML. Note that <code>pandoc</code> is not an R library, check the <a href="https://pandoc.org/installing.html" class="external-link">pandoc</a> page for installation instructions. For the minute, it seems like everything in the <code>doc</code> directory is built automatically based on the <code>*.Rmd</code> files in <code>vignettes</code>. Iterating through the build process a few more times should help clarify this.</p>
</div>
<div class="section level4">
<h4 id="package-website">Package website<a class="anchor" aria-label="anchor" href="#package-website"></a></h4>
<p>We use the static site generator <code>pkgdown</code> as follows</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://pkgdown.r-lib.org/" class="external-link">"pkgdown"</a></span><span class="op">)</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
<p>This produces relevant text files in the <code>docs/</code> directory. We commit this to the <code>gh-pages</code> branch to avoid polluting the <code>main</code> branch, which is reserved for source code.</p>
</div>
</div>
<div class="section level3">
<h3 id="r-internals-and-cc">R internals and C/C++<a class="anchor" aria-label="anchor" href="#r-internals-and-cc"></a></h3>
<p>C and C++ extensions to R are often bound using the <code>Rcpp</code> package. Since our package is relatively simple, we avoid incurring the additional dependancy that <code>Rcpp</code> incurs, and instead perform bindings using the basic API that R provides for C/C++ extensions. Technically this binding is implemented in the header file <code>Rinternals.h</code>, with some additional material in <code>Rdefine.h</code> and <code>R.h</code>. The location of these is given by <code>R RHOME</code>, with the full paths on macOS being</p>
<pre><code>/usr/local/Cellar/r/4.2.3/include/Rinternals.h
/usr/local/Cellar/r/4.2.3/include/Rdefines.h
/usr/local/Cellar/r/4.2.3/include/R.h</code></pre>
<p>Some helpful resources for learning the basics of the R API for C are given below.</p>
<div class="section level4">
<h4 id="resources">Resources<a class="anchor" aria-label="anchor" href="#resources"></a></h4>
<p>I found the following resources to be most helpful in learning R’s C API</p>
<ul><li>a gentle <a href="http://adv-r.had.co.nz/C-interface.html" class="external-link">overview</a> by Hadley Wickham</li>
<li>the authoritative <a href="https://cran.r-project.org/doc/manuals/r-release/R-ints.html" class="external-link">R internals</a> manual by the core R team</li>
<li>the above has been parsed and simplified in <a href="https://github.com/hadley/r-internals" class="external-link">R internals</a> by Hadley Wickham</li>
</ul><p>In addition <a href="https://www.r-bloggers.com/author/jonathan-callahan/" class="external-link">these</a> blogs by Jonathan Callahan helped me in the very beginning. An overview of the C interface can be found <a href="https://www.r-bloggers.com/2012/11/using-r-calling-c-code-hello-world/" class="external-link">here</a> and <a href="https://www.r-bloggers.com/2012/11/using-r-callhello/" class="external-link">here</a>, and a packaging walkthrough <a href="https://www.r-bloggers.com/2012/11/using-r-packaging-a-c-library-in-15-minutes/" class="external-link">here</a>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="resources-1">Resources<a class="anchor" aria-label="anchor" href="#resources-1"></a></h2>
<p>In addition to the <a href="https://cran.r-project.org/" class="external-link">CRAN</a> home page, which contains a handful of incredibly useful manuals (under the <em>Documentation</em> section), I have found the following to be helpful</p>
<ul><li>the section <a href="https://cran.r-project.org/" class="external-link">Writing R extensions</a> in the CRAN documentation is an absolute must read. However, there’s a steep learning curve if you’re not yet familiar with R’s API for C</li>
<li>
<a href="https://r-pkgs.org/" class="external-link">R packages</a> by Hadley Wickham is an excellent guide to packaging best practice, and is much more readable than hardcore CRAN documentation</li>
<li>indeed anything about R development by <a href="https://hadley.nz/" class="external-link">Hadley Wickham</a> I would strongly recommend, he seems to be one of the stars of the R community</li>
<li>the so-called <a href="https://github.com/tidyverse" class="external-link">tidyverse</a> suite of packages demonstrates R best practice in my opinion. There are plenty of beautiful packages in there on which we can model ours. Several include sophisticated C and C++ source libraries (Hadley Wickham is involved in a bunch of these. Incidentally, it would be wonderful if he is available for code review. Can funding be allocated for this kind of thing?)</li>
<li>see the resources in the section above on R internals</li>
<li>Hadley Wickham has an <a href="http://adv-r.had.co.nz/Style.html" class="external-link">R style guide</a> that would be good to follow</li>
</ul></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel Unicomb, Ana Jovancevic, Alejandro Dinkelberg, Pádraig MacCarron, David O’Sullivan, Paul Maher, Mike Quayle.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

